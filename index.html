<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PVP: Chaos Edition (Fixed UI)</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: 'Courier New', sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; }
        
        /* HJERTENE - Tilbake til r√∏d og riktig st√∏rrelse */
        .hearts { position: absolute; display: flex; gap: 5px; z-index: 25; pointer-events: none; }
        .p1-hearts { bottom: 110px; left: 20px; }
        .p2-hearts { top: 110px; right: 20px; transform: rotate(180deg); }
        .heart { font-size: 24px; color: #ff0044; text-shadow: 0 0 5px rgba(255,0,0,0.5); }

        .controls { position: absolute; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; z-index: 20; pointer-events: none; }
        .p1-controls { bottom: 20px; }
        .p2-controls { top: 20px; transform: rotate(180deg); }
        .btn { width: 85px; height: 85px; background: rgba(255, 255, 255, 0.1); border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 35px; pointer-events: auto; }

        /* EVENT TEKST - N√• byttet om */
        .event-banner {
            position: absolute; width: 100%; height: 100%;
            display: none; pointer-events: none; z-index: 30;
        }
        .event-text {
            position: absolute; width: 100%; text-align: center;
            font-size: 28px; font-weight: bold; color: yellow;
            text-shadow: 0 0 10px #f00;
        }
        #text-p1 { top: 20%; transform: rotate(180deg); } 
        #text-p2 { bottom: 20%; }

        #gameOver { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 100; flex-direction: column; align-items: center; justify-content: center; }
        video { width: 100%; height: 70%; }
    </style>
</head>
<body>

<div class="event-banner" id="event-banner">
    <div class="event-text" id="text-p1">EVENT!</div>
    <div class="event-text" id="text-p2">EVENT!</div>
</div>

<div class="hearts p2-hearts" id="p2-hearts-container">
    <span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span>
</div>
<div class="controls p2-controls">
    <div class="btn" id="p2Left">‚óÄ</div>
    <div class="btn" id="p2Right">‚ñ∂</div>
</div>

<div class="hearts p1-hearts" id="p1-hearts-container">
    <span class="heart">‚ù§</span><span class="heart">‚ù§</span><span class="heart">‚ù§</span>
</div>
<div class="controls p1-controls">
    <div class="btn" id="p1Left">‚óÄ</div>
    <div class="btn" id="p1Right">‚ñ∂</div>
</div>

<div id="gameOver">
    <h1 id="status" style="color:white; text-align:center;">GET ROLLED!</h1>
    <video id="rickVideo" playsinline loop>
        <source src="https://dn721809.ca.archive.org/0/items/youtube-xvFZjo5PgG0/xvFZjo5PgG0.mp4" type="video/mp4">
    </video>
    <button onclick="location.reload()" style="padding:15px; margin-top:20px; border-radius:10px;">REMATCH</button>
</div>

<canvas id="game"></canvas>

<script>
    const SETTINGS = {
        eventFrequency: 10000, 
        eventDuration: 5000,  
        baseSpeed: 7,         
        superChargeTime: 60,  
        cooldownTime: 60      
    };

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameActive = true;
    let currentSpeed = SETTINGS.baseSpeed;
    const bullets = [];
    const dangerZones = [];
    let activeEvent = null;

    const createPlayer = (y, color, id) => ({
        x: canvas.width / 2, y, color, id, 
        w: 50, h: 25, dir: 0, hp: 3, 
        cooldown: 0, charge: 0, isCharging: false,
        tripleShot: false, opacity: 1
    });

    const p1 = createPlayer(canvas.height - 80, '#0f0', 1);
    const p2 = createPlayer(80, '#0cf', 2);

    function updateHeartsUI(p) {
        const container = document.getElementById(`p${p.id}-hearts-container`);
        container.innerHTML = '<span class="heart">‚ù§</span>'.repeat(Math.max(0, Math.floor(p.hp)));
    }

    // --- INPUT ---
    const setupBtn = (id, p, dir) => {
        const b = document.getElementById(id);
        b.addEventListener('touchstart', (e) => { e.preventDefault(); p.dir = dir; });
        b.addEventListener('touchend', (e) => { e.preventDefault(); p.dir = 0; });
    };
    setupBtn('p1Left', p1, -1); setupBtn('p1Right', p1, 1);
    setupBtn('p2Left', p2, 1);  setupBtn('p2Right', p2, -1);

    window.addEventListener('touchstart', (e) => {
        if (!gameActive || e.target.className.includes('btn')) return;
        const p = e.touches[0].clientY > canvas.height/2 ? p1 : p2;
        if (p.cooldown <= 0) p.isCharging = true;
    });

    window.addEventListener('touchend', () => {
        [p1, p2].forEach(p => { if (p.isCharging) { fire(p); p.isCharging = false; } });
    });

    function fire(p) {
        const isSuper = p.charge > SETTINGS.superChargeTime;
        const damage = isSuper ? 3 : 1;
        const speed = p.id === 1 ? -9 : 9;
        const createB = (vx = 0) => {
            bullets.push({ 
                x: p.x + p.w/2, y: p.y, vx: vx, vy: speed, 
                dmg: damage, size: isSuper ? 22 : 6, 
                owner: p.id, color: isSuper ? '#ff0044' : '#fff'
            });
        };
        if (p.tripleShot) { createB(-3); createB(0); createB(3); p.tripleShot = false; } 
        else { createB(0); }
        p.charge = 0;
        p.cooldown = (activeEvent === 'NO_CD') ? 5 : SETTINGS.cooldownTime; 
    }

    // --- EVENTS ---
    function triggerEvent() {
        if (!gameActive) return;
        const events = ['NO_CD', 'TRIPLE', 'SUDDEN', 'DANGER', 'GHOST', 'SPEED', 'STORM'];
        const evt = events[Math.floor(Math.random() * events.length)];
        const banner = document.getElementById('event-banner');
        const t1 = document.getElementById('text-p1');
        const t2 = document.getElementById('text-p2');

        banner.style.display = 'block';

        switch(evt) {
            case 'NO_CD': t1.innerText = t2.innerText = "‚ö° NO COOLDOWN! ‚ö°"; activeEvent = 'NO_CD'; setTimeout(() => activeEvent = null, SETTINGS.eventDuration); break;
            case 'TRIPLE': t1.innerText = t2.innerText = "üèπ TRIPLE SHOT! üèπ"; p1.tripleShot = p2.tripleShot = true; break;
            case 'GHOST': t1.innerText = t2.innerText = "üëª INVISIBILITY! üëª"; p1.opacity = 0.15; p2.opacity = 0.15; setTimeout(() => { p1.opacity = 1; p2.opacity = 1; }, SETTINGS.eventDuration); break;
            case 'SPEED': t1.innerText = t2.innerText = "üöÄ HYPER SPEED! üöÄ"; currentSpeed = 16; setTimeout(() => currentSpeed = SETTINGS.baseSpeed, SETTINGS.eventDuration); break;
            case 'SUDDEN': 
                if (p1.hp > 2 && p2.hp > 2) { t1.innerText = t2.innerText = "üí• SUDDEN IMPACT! -2HP"; p1.hp -= 2; p2.hp -= 2; updateHeartsUI(p1); updateHeartsUI(p2); } 
                else { triggerEvent(); return; } break;
            case 'DANGER': 
                t1.innerText = t2.innerText = "üî• LANE DANGER! üî•";
                for(let i=0; i<2; i++) {
                    dangerZones.push({x: Math.random()*(canvas.width-80), y: p1.y - 15, w: 80, h: 40, life: 300});
                    dangerZones.push({x: Math.random()*(canvas.width-80), y: p2.y - 15, w: 80, h: 40, life: 300});
                }
                break;
            case 'STORM':
                t1.innerText = t2.innerText = "‚õàÔ∏è BULLET STORM! ‚õàÔ∏è";
                for(let i=0; i<12; i++) {
                    setTimeout(() => {
                        bullets.push({x: Math.random()*canvas.width, y: canvas.height/2, vx: (Math.random()-0.5)*4, vy: 5, dmg: 1, size: 5, owner: 0, color: 'yellow'});
                        bullets.push({x: Math.random()*canvas.width, y: canvas.height/2, vx: (Math.random()-0.5)*4, vy: -5, dmg: 1, size: 5, owner: 0, color: 'yellow'});
                    }, i * 300);
                }
                break;
        }

        setTimeout(() => banner.style.display = 'none', 2500);
        setTimeout(triggerEvent, SETTINGS.eventFrequency + (Math.random() * 4000));
    }

    function checkDeath(target) {
        if (target.hp <= 0) {
            gameActive = false;
            document.getElementById('gameOver').style.display = 'flex';
            document.getElementById('status').innerText = `PLAYER ${target.id === 1 ? '1' : '2'} GOT ROLLED!`;
            document.getElementById('rickVideo').play();
        }
    }

    function update() {
        if (!gameActive) return;

        [p1, p2].forEach(p => {
            p.x += p.dir * currentSpeed;
            p.x = Math.max(0, Math.min(canvas.width - p.w, p.x));
            if (p.cooldown > 0) p.cooldown--;
            if (p.isCharging) p.charge++;

            dangerZones.forEach(z => {
                if (p.x < z.x + z.w && p.x + p.w > z.x && p.y < z.y + z.h && p.y + p.h > z.y) {
                    p.hp -= 0.025; updateHeartsUI(p); checkDeath(p);
                }
            });
        });

        bullets.forEach((b, i) => {
            b.y += b.vy; b.x += b.vx;
            [p1, p2].forEach(target => {
                if (b.owner !== target.id && b.x > target.x && b.x < target.x + target.w && b.y > target.y && b.y < target.y + target.h) {
                    target.hp -= b.dmg; updateHeartsUI(target);
                    bullets.splice(i, 1);
                    checkDeath(target);
                }
            });
            if (b.y < -50 || b.y > canvas.height + 50) bullets.splice(i, 1);
        });

        dangerZones.forEach((z, i) => { z.life--; if(z.life <= 0) dangerZones.splice(i, 1); });
        draw();
        requestAnimationFrame(update);
    }

    function draw() {
        ctx.fillStyle = '#000'; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.setLineDash([5, 15]);
        ctx.beginPath(); ctx.moveTo(0, canvas.height/2); ctx.lineTo(canvas.width, canvas.height/2); ctx.stroke();

        dangerZones.forEach(z => {
            ctx.fillStyle = `rgba(255, 0, 0, ${Math.abs(Math.sin(Date.now()/200)) * 0.7})`;
            ctx.fillRect(z.x, z.y, z.w, z.h);
            ctx.strokeStyle = "white"; ctx.setLineDash([]); ctx.strokeRect(z.x, z.y, z.w, z.h);
        });

        [p1, p2].forEach(p => {
            ctx.globalAlpha = p.opacity;
            ctx.fillStyle = p.color;
            if (p.isCharging && p.charge > SETTINGS.superChargeTime) { ctx.shadowBlur = 15; ctx.shadowColor = '#ff0044'; }
            ctx.fillRect(p.x, p.y, p.w, p.h);
            ctx.shadowBlur = 0; ctx.globalAlpha = 1;
        });

        bullets.forEach(b => {
            ctx.fillStyle = b.color;
            ctx.beginPath(); ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2); ctx.fill();
        });
    }

    setTimeout(triggerEvent, 5000);
    update();
</script>
</body>
</html>
